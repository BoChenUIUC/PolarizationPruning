#!/usr/bin/python

import numpy as np
import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
import os
labelsize_b = 13
linewidth = 2
plt.rcParams['xtick.labelsize'] = 16
plt.rcParams['ytick.labelsize'] = 16
plt.rcParams["font.family"] = "Times New Roman"
colors = ['#DB1F48','#FF9636','#1C4670','#9D5FFB','#21B6A8','#D65780']
markers = ['o','^','s','>','P','D']


def line_plot(XX,YY,label,color,path,xlabel,ylabel,lbsize=labelsize_b,lfsize=labelsize_b,legloc='best',
				xticks=None,yticks=None,ncol=None, yerr=None,
				use_arrow=False,arrow_coord=(0.4,30)):
	fig, ax = plt.subplots()
	ax.grid(zorder=0)
	for i in range(len(XX)):
		xx,yy = XX[i],YY[i]
		if yerr is None:
			plt.plot(xx, yy, color = color[i], marker = markers[i], 
				# linestyle = linestyles[i], 
				label = label[i], 
				linewidth=2, markersize=8)
		else:
			plt.errorbar(xx, yy, yerr=yerr[i], color = color[i], 
				marker = markers[i], label = label[i], 
				linewidth=2, markersize=8)
	plt.xlabel(xlabel, fontsize = lbsize)
	plt.ylabel(ylabel, fontsize = lbsize)
	if xticks is not None:
		plt.xticks(xticks,fontsize=lfsize)
	if yticks is not None:
		plt.yticks(yticks,fontsize=lfsize)
	if use_arrow:
		ax.text(
		    arrow_coord[0], arrow_coord[1], "Better", ha="center", va="center", rotation=-45, size=lbsize-8,
		    bbox=dict(boxstyle="larrow,pad=0.3", fc="white", ec="black", lw=2))
	plt.tight_layout()
	if ncol!=0:
		if ncol is None:
			plt.legend(loc=legloc,fontsize = lfsize)
		else:
			plt.legend(loc=legloc,fontsize = lfsize,ncol=ncol)
	# xleft, xright = ax.get_xlim()
	# ybottom, ytop = ax.get_ylim()
	# ratio = 0.3
	# ax.set_aspect(abs((xright-xleft)/(ybottom-ytop))*ratio)
	plt.tight_layout()
	fig.savefig(path,bbox_inches='tight')
	plt.close()

# breakdown for different traces
def plot_latency_breakdown():
	latency_breakdown_mean = [
	[0.005118496806476825, 0.014244282516843962, 0.00025276993029414653, 0.7486890470647757],
	[0.005116511686160541, 0.014154067105823715, 0.0002520886473000621, 0.3673184008753988]
	]
	latency_breakdown_std = [
	[0.0001587420494238616, 0.001099566615160111, 3.956707547424717e-05, 0.34634288409670605],
	[0.0001597390393148955, 0.001158714715454943, 3.9306694510438234e-05, 0.03245713266930838]
	]
	latency_breakdown_mean = np.array(latency_breakdown_mean).transpose((1,0))
	latency_breakdown_std = np.array(latency_breakdown_std).transpose((1,0))
	latency_types = ['N-Map','DCN','N-Reduce','WAN']
	y_pos = np.arange(2)
	width = 0.5
	plt.rcdefaults()
	fig, (ax1,ax2) = plt.subplots(1,2,sharey=True)
	for ax in [ax1,ax2]:
		left = np.array([0.0,0.0])
		for i in range(4):
			ax.barh(y_pos, latency_breakdown_mean[i], width, color=colors[i], xerr=latency_breakdown_std[i], left=left, label=latency_types[i], align='center')
			left += latency_breakdown_mean[i]
	ax1.set_xlim(0,0.02)
	ax2.set_xlim(0.02,1)
	ax1.spines['right'].set_visible(False)
	ax2.spines['left'].set_visible(False)
	ax1.yaxis.tick_left()
	d = .03 # how big to make the diagonal lines in axes coordinates
	# arguments to pass plot, just so we don't keep repeating them
	kwargs = dict(transform=ax1.transAxes, color='r', clip_on=False)
	ax1.plot((1-d,1+d), (-d,+d), **kwargs)
	ax1.plot((1-d,1+d),(1-d,1+d), **kwargs)

	kwargs.update(transform=ax2.transAxes)  # switch to the bottom axes
	ax2.plot((-d,+d), (1-d,1+d), **kwargs)
	ax2.plot((-d,+d), (-d,+d), **kwargs)

	ax1.set_yticks(y_pos, labels=['FCC','Wi-Fi'], fontsize = 14)

	handles, labels = ax2.get_legend_handles_labels()
	fig.legend(handles, labels,bbox_to_anchor=(0.5,0.7),ncol=4,fancybox=True, loc='upper center', fontsize=14)
	ax1.invert_yaxis()  
	for ax in [ax1,ax2]:
		xleft, xright = ax.get_xlim()
		ybottom, ytop = ax.get_ylim()
		ratio = 0.35
		ax.set_aspect(abs((xright-xleft)/(ybottom-ytop))*ratio)
	plt.tight_layout()
	fig.savefig('/home/bo/Dropbox/Research/SIGCOMM23/images/latency_breakdown.eps',bbox_inches='tight')

def measurements_to_cdf(b32_latency,epsfile):
    lbsize = 18
    labels = ['DCN','DCN-LD','Wi-Fi','FCC']
    linestyles = ['solid','dashed','dotted','dashdot']
    # plot cdf
    fig, ax = plt.subplots()
    ax.grid(zorder=0)
    for i,latency_list in enumerate(b32_latency):
        N = len(latency_list)
        cdf_x = np.sort(np.array(latency_list))
        cdf_p = np.array(range(N))/float(N)
        plt.plot(cdf_x, cdf_p, color = colors[i], label = labels[i], linewidth=4, linestyle=linestyles[i])
    plt.xlabel('Communication Delay (s)', fontsize = lbsize)
    plt.ylabel('CDF', fontsize = lbsize)
    # xleft, xright = ax.get_xlim()
    # ybottom, ytop = ax.get_ylim()
    # ratio = 0.3
    # ax.set_aspect(abs((xright-xleft)/(ybottom-ytop))*ratio)
    plt.legend(loc='lower right',fontsize = lbsize)
    plt.tight_layout()
    fig.savefig(epsfile,bbox_inches='tight')
    plt.close()

def analyze_all_recorded_traces():
    print('Analyzing all recorded traces...')
    b32_latency = []
    x = [[2**(i) for i in range(7)] for _ in range(4)]
    y = []
    yerr = []
    # batch 1,2,4,8,16,32
    trace_filenames = ['../DCN/000022','../DCN/000044','../DCN/000088','../DCN/000176','../DCN/000352','../DCN/000704','../DCN/001408',
                        '../DCN-LD/000022','../DCN-LD/000044','../DCN-LD/000088','../DCN-LD/000176','../DCN-LD/000352','../DCN-LD/000704','../DCN-LD/001408',
                        '../WAN/000012','../WAN/000024','../WAN/000048','../WAN/000096','../WAN/000192','../WAN/000384','../WAN/000768']
    latency_mean_list = []
    latency_std_list = []
    for tidx,filename in enumerate(trace_filenames):
        latency_list = []
        bandwidth_list = []
        with open(filename,'r') as f:
            for l in f.readlines():
                l = l.strip().split(' ')
                latency_list += [float(l[0])/1e3]
        latency_mean,latency_std = np.array(latency_list).mean(),np.array(latency_list).std()
        latency_mean_list += [latency_mean]
        latency_std_list += [latency_std]
        if tidx in [6,13,20]:
            b32_latency += [latency_list]
            y += [latency_mean_list]
            yerr += [latency_std_list]
            latency_mean_list = []
            latency_std_list = []
    import csv
    with open('../curr_videostream.csv', mode='r') as csv_file:
        # read network traces 
        csv_reader = csv.DictReader(csv_file)
        latency_list = []
        num_of_line = 0
        for row in csv_reader:
            if float(row["latency"])>1e7 or float(row["latency"])<0 or float(row["downthrpt"])>1e8:
                continue
            for bs in [2**i for i in range(7)]:
                query_size = 3*32*32*4*bs # bytes
                latency_list += [query_size/float(row["downthrpt"]) + float(row["latency"])/1e6]
            num_of_line += 1
            if num_of_line==10000:break
        latency_list = np.array(latency_list).reshape((num_of_line,7))
        latency_mean,latency_std = latency_list.mean(axis=0),latency_list.std(axis=0)
        y += [latency_mean.tolist()]
        yerr += [latency_std.tolist()]
        b32_latency += [latency_list[:,5]]
    measurements_to_cdf(b32_latency,'/home/bo/Dropbox/Research/SIGCOMM23/images/latency_cdf.eps')
    line_plot(x, y,['DCN','DCN-LD','Wi-Fi','FCC'],colors,
		'/home/bo/Dropbox/Research/SIGCOMM23/images/latency_vs_bs.eps',
		'Query Batch Size','Latency per Query (s)',yerr=yerr)	

# correctness vs. # of Queries
# one node: no loss vs. loss
# two nodes: node 0/1 curve and total curve

# success rate vs. nodes

our_correctness = [[1.0, 0.9375, 0.96875, 0.9375, 0.9375, 0.96875, 0.96875, 0.875, 0.9375, 0.90625, 0.90625, 0.96875, 0.90625, 0.9375, 0.9375, 0.96875, 0.90625, 0.96875, 0.96875, 0.96875, 0.875, 0.9375, 1.0, 0.96875, 0.90625, 0.96875, 0.875, 0.9375, 0.96875, 0.9375, 0.9375, 1.0, 0.9375, 0.9375, 1.0, 0.96875, 0.96875, 0.96875, 0.96875, 0.90625, 0.90625, 0.96875, 0.96875, 0.96875, 0.90625, 1.0, 0.9375, 0.96875, 0.9375, 0.9375, 0.9375, 0.9375, 1.0, 0.9375, 0.9375, 0.96875, 0.90625, 0.90625, 0.96875, 0.84375, 0.90625, 0.96875, 1.0, 0.90625, 0.90625, 1.0, 0.9375, 1.0, 0.875, 0.96875, 0.96875, 0.9375, 1.0, 0.9375, 0.90625, 0.875, 0.9375, 0.96875, 0.875, 0.96875, 0.96875, 0.96875, 0.96875, 0.90625, 0.9375, 0.96875, 0.9375, 0.96875, 0.96875, 0.875, 0.96875, 0.9375, 0.78125, 0.90625, 0.9375, 0.9375, 0.84375, 0.90625, 1.0, 1.0, 1.0, 0.9375, 0.84375, 0.96875, 0.90625, 1.0, 0.96875, 0.96875, 0.96875, 0.9375, 0.875, 0.96875, 0.96875, 0.90625, 0.96875, 0.9375, 0.96875, 0.9375, 1.0, 0.9375, 0.96875, 0.96875, 0.9375, 0.90625, 1.0, 0.9375, 0.90625, 1.0, 0.96875, 0.90625, 0.9375, 0.96875, 0.9375, 0.9375, 0.9375, 0.9375, 0.90625, 1.0, 0.96875, 0.9375, 1.0, 1.0, 1.0, 0.9375, 0.875, 0.875, 0.90625, 0.9375, 0.96875, 0.90625, 0.9375, 0.9375, 0.90625, 1.0, 0.96875, 0.96875, 0.90625, 0.96875, 0.96875, 0.96875, 0.9375, 0.9375, 0.9375, 0.96875, 1.0, 0.90625, 0.90625, 0.90625, 0.90625, 0.875, 0.9375, 0.96875, 0.96875, 0.84375, 0.96875, 0.96875, 0.90625, 0.84375, 0.9375, 0.9375, 0.90625, 0.96875, 0.9375, 0.90625, 0.90625, 0.9375, 0.9375, 0.96875, 0.875, 1.0, 0.96875, 0.96875, 0.9375, 0.96875, 0.90625, 1.0, 0.96875, 0.90625, 0.875, 0.9375, 0.875, 0.9375, 0.9375, 1.0, 0.9375, 1.0, 0.9375, 1.0, 0.96875, 1.0, 1.0, 0.96875, 0.96875, 0.9375, 0.96875, 0.875, 0.96875, 0.96875, 1.0, 0.9375, 0.90625, 0.9375, 0.96875, 0.84375, 0.90625, 0.9375, 0.96875, 0.90625, 0.9375, 0.96875, 0.90625, 0.96875, 0.9375, 0.96875, 0.96875, 0.90625, 0.9375, 0.90625, 0.9375, 0.90625, 0.84375, 0.96875, 0.9375, 0.96875, 1.0, 0.9375, 0.96875, 0.96875, 0.90625, 0.96875, 0.90625, 0.96875, 0.90625, 0.96875, 0.9375, 1.0, 0.9375, 0.90625, 0.9375, 1.0, 0.9375, 0.96875, 1.0, 0.96875, 0.9375, 0.9375, 0.90625, 0.96875, 0.90625, 0.96875, 0.90625, 0.90625, 0.9375, 0.96875, 0.9375, 1.0, 0.90625, 1.0, 0.96875, 0.96875, 0.9375, 0.96875, 0.90625, 0.9375, 0.9375, 0.9375, 0.90625, 0.90625, 0.96875, 0.875, 0.96875, 0.90625, 0.9375, 0.9375, 0.9375, 0.90625, 1.0, 0.9375, 0.9375, 0.9375, 0.8125, 0.90625, 0.9375, 0.84375, 0.90625, 0.84375, 0.96875, 0.96875, 0.875, 0.90625, 1.0, 0.96875, 0.875], [0.96875, 0.9375, 0.96875, 1.0, 0.90625, 1.0, 0.96875, 0.875, 0.9375, 0.875, 0.875, 0.8125, 0.90625, 0.90625, 0.9375, 0.96875, 1.0, 0.9375, 0.84375, 0.90625, 0.875, 0.9375, 1.0, 0.9375, 0.9375, 0.90625, 0.96875, 0.9375, 0.90625, 0.96875, 0.9375, 0.84375, 0.78125, 0.9375, 0.9375, 0.90625, 0.9375, 0.96875, 0.9375, 0.90625, 0.90625, 0.96875, 0.9375, 0.9375, 0.9375, 0.9375, 0.9375, 1.0, 0.96875, 0.96875, 0.9375, 0.9375, 0.84375, 0.90625, 0.875, 0.90625, 0.96875, 0.96875, 0.90625, 0.9375, 1.0, 0.96875, 0.9375, 0.9375, 0.96875, 0.9375, 0.96875, 0.96875, 0.96875, 0.9375, 0.96875, 1.0, 0.96875, 0.96875, 0.90625, 0.96875, 0.96875, 0.96875, 0.9375, 0.9375, 0.90625, 0.96875, 0.9375, 0.9375, 0.96875, 0.90625, 0.90625, 0.9375, 0.96875, 0.90625, 0.9375, 0.90625, 0.90625, 0.875, 0.90625, 0.96875, 1.0, 0.90625, 0.96875, 0.9375, 0.96875, 0.96875, 0.90625, 0.90625, 0.875, 0.9375, 0.875, 0.96875, 0.96875, 0.90625, 0.9375, 0.9375, 0.84375, 0.96875, 0.96875, 0.90625, 0.9375, 1.0, 0.9375, 0.9375, 0.96875, 0.90625, 0.96875, 0.96875, 0.96875, 0.8125, 0.9375, 0.9375, 0.9375, 0.9375, 0.96875, 0.875, 0.875, 0.90625, 0.96875, 1.0, 0.96875, 0.9375, 0.96875, 0.96875, 0.9375, 0.9375, 0.9375, 0.96875, 0.875, 0.9375, 1.0, 0.84375, 0.96875, 0.90625, 0.90625, 0.9375, 0.96875, 0.875, 1.0, 1.0, 0.9375, 0.9375, 0.96875, 0.90625, 0.90625, 1.0, 0.90625, 1.0, 0.875, 0.875, 0.875, 0.90625, 0.96875, 0.9375, 0.96875, 0.9375, 0.9375, 0.90625, 0.96875, 0.9375, 0.90625, 0.90625, 0.875, 0.9375, 0.96875, 0.9375, 0.90625, 0.9375, 0.9375, 0.96875, 1.0, 0.96875, 1.0, 0.9375, 0.96875, 0.9375, 0.90625, 0.96875, 1.0, 1.0, 0.96875, 1.0, 0.90625, 0.90625, 0.96875, 0.9375, 0.90625, 0.96875, 0.9375, 0.96875, 0.90625, 1.0, 0.84375, 0.9375, 0.8125, 0.9375, 0.96875, 0.9375, 0.96875, 1.0, 0.9375, 0.875, 1.0, 0.96875, 1.0, 0.9375, 1.0, 0.90625, 0.96875, 0.9375, 0.875, 0.96875, 0.96875, 0.90625, 1.0, 0.96875, 0.90625, 0.96875, 1.0, 0.875, 0.875, 0.96875, 0.84375, 0.96875, 0.96875, 0.96875, 0.90625, 0.9375, 0.875, 1.0, 0.96875, 0.96875, 0.90625, 0.96875, 1.0, 0.96875, 0.96875, 0.96875, 0.96875, 0.90625, 0.96875, 1.0, 0.875, 0.9375, 0.9375, 0.875, 0.96875, 1.0, 1.0, 0.9375, 0.875, 0.96875, 0.90625, 0.90625, 0.90625, 0.90625, 0.96875, 0.9375, 0.9375, 0.9375, 0.96875, 0.9375, 0.96875, 1.0, 1.0, 1.0, 1.0, 0.96875, 0.96875, 0.96875, 1.0, 0.9375, 0.96875, 0.9375, 0.96875, 0.875, 0.9375, 0.875, 0.96875, 0.96875, 0.96875, 0.9375, 1.0, 0.9375, 0.96875, 0.90625, 0.96875, 0.9375, 0.9375, 1.0, 0.90625, 0.90625, 1.0, 0.9375, 0.96875, 0.90625, 0.9375], [0.875, 0.96875, 0.9375, 0.9375, 0.96875, 0.90625, 0.9375, 0.84375, 0.96875, 0.96875, 1.0, 0.9375, 0.9375, 0.9375, 0.9375, 0.875, 1.0, 0.875, 0.9375, 0.96875, 0.9375, 1.0, 0.9375, 0.84375, 0.9375, 0.90625, 0.9375, 0.9375, 0.9375, 0.9375, 0.90625, 0.9375, 0.90625, 0.875, 0.90625, 0.9375, 0.9375, 0.9375, 0.84375, 0.875, 0.90625, 1.0, 0.90625, 0.96875, 0.90625, 0.90625, 0.9375, 0.9375, 0.875, 0.9375, 0.96875, 0.9375, 0.90625, 0.875, 0.96875, 0.875, 0.90625, 0.96875, 1.0, 0.9375, 0.90625, 0.9375, 0.90625, 0.875, 0.90625, 0.96875, 0.96875, 0.9375, 0.96875, 0.96875, 0.9375, 0.9375, 0.96875, 0.875, 0.9375, 0.9375, 0.84375, 1.0, 0.96875, 0.875, 0.96875, 0.96875, 0.96875, 0.90625, 0.9375, 0.96875, 0.96875, 0.96875, 0.9375, 0.90625, 0.90625, 0.90625, 0.9375, 0.875, 0.8125, 0.9375, 1.0, 0.90625, 0.96875, 0.96875, 0.90625, 0.9375, 0.875, 0.875, 1.0, 0.96875, 0.875, 1.0, 0.96875, 0.96875, 0.84375, 0.90625, 0.90625, 0.96875, 0.875, 0.90625, 0.9375, 0.96875, 0.96875, 0.9375, 0.90625, 0.9375, 0.96875, 0.90625, 0.90625, 0.90625, 0.96875, 0.84375, 0.9375, 0.9375, 0.875, 0.9375, 0.9375, 0.9375, 0.875, 0.9375, 0.96875, 0.9375, 0.90625, 0.90625, 0.96875, 0.9375, 0.96875, 0.90625, 0.875, 0.96875, 0.96875, 0.96875, 1.0, 0.96875, 0.9375, 0.90625, 0.875, 0.71875, 0.9375, 0.875, 1.0, 0.9375, 0.9375, 0.84375, 1.0, 0.9375, 0.96875, 0.875, 0.9375, 0.9375, 0.90625, 0.84375, 0.90625, 0.9375, 0.9375, 1.0, 0.9375, 0.78125, 0.9375, 0.90625, 0.90625, 0.96875, 0.9375, 0.875, 0.9375, 0.96875, 0.9375, 0.9375, 0.9375, 0.90625, 0.875, 0.90625, 0.875, 0.96875, 0.84375, 0.96875, 0.96875, 0.9375, 1.0, 0.96875, 0.9375, 0.84375, 0.875, 0.9375, 0.90625, 0.90625, 0.96875, 0.9375, 0.90625, 0.9375, 0.9375, 0.9375, 0.9375, 0.96875, 0.875, 0.90625, 0.90625, 0.875, 0.9375, 0.9375, 0.90625, 0.9375, 0.90625, 0.9375, 0.875, 1.0, 0.90625, 0.96875, 0.875, 0.9375, 0.96875, 0.96875, 0.96875, 0.90625, 0.9375, 0.9375, 0.9375, 0.9375, 0.9375, 0.90625, 0.96875, 0.9375, 0.875, 0.96875, 0.9375, 0.90625, 0.96875, 0.78125, 0.875, 0.9375, 0.90625, 0.90625, 0.96875, 0.90625, 0.9375, 0.96875, 0.9375, 0.9375, 0.90625, 0.8125, 1.0, 0.96875, 0.9375, 0.90625, 0.96875, 0.90625, 0.96875, 0.96875, 0.90625, 1.0, 1.0, 0.9375, 0.875, 0.90625, 1.0, 0.9375, 0.84375, 0.9375, 0.96875, 0.96875, 1.0, 0.96875, 0.96875, 0.84375, 0.875, 0.875, 0.96875, 0.90625, 0.84375, 0.875, 0.96875, 0.96875, 0.9375, 0.96875, 1.0, 0.90625, 0.96875, 0.90625, 0.90625, 0.90625, 0.9375, 0.9375, 0.84375, 0.9375, 0.9375, 0.84375, 0.96875, 0.84375, 0.90625, 0.9375, 0.875, 0.84375, 0.90625, 0.96875, 0.9375, 0.9375, 0.9375], [0.96875, 0.90625, 0.90625, 0.9375, 0.875, 0.8125, 0.96875, 0.9375, 0.84375, 0.84375, 0.875, 0.96875, 0.9375, 0.90625, 0.78125, 0.90625, 0.875, 0.90625, 0.875, 0.9375, 0.90625, 0.9375, 0.78125, 0.9375, 0.90625, 0.90625, 0.875, 0.90625, 0.9375, 0.84375, 0.9375, 0.78125, 0.84375, 0.96875, 0.875, 0.875, 0.9375, 0.8125, 0.90625, 0.90625, 0.90625, 0.9375, 0.96875, 0.875, 1.0, 0.90625, 0.96875, 0.9375, 0.875, 0.90625, 0.9375, 0.90625, 0.96875, 0.90625, 0.78125, 0.90625, 0.9375, 0.875, 0.90625, 0.9375, 0.9375, 1.0, 0.9375, 0.90625, 0.9375, 0.9375, 0.84375, 0.96875, 0.875, 0.96875, 0.9375, 0.90625, 0.84375, 0.90625, 0.75, 0.875, 0.96875, 0.96875, 0.90625, 0.875, 0.875, 0.875, 0.90625, 0.8125, 0.875, 0.96875, 0.8125, 0.90625, 0.9375, 0.90625, 0.84375, 0.90625, 0.9375, 0.9375, 0.875, 0.84375, 0.96875, 0.84375, 0.875, 0.9375, 0.84375, 0.96875, 0.875, 0.90625, 0.875, 0.90625, 0.90625, 1.0, 0.96875, 0.875, 0.75, 0.90625, 0.875, 0.90625, 0.9375, 0.84375, 0.90625, 1.0, 0.90625, 0.875, 0.9375, 0.9375, 0.9375, 0.875, 0.9375, 0.84375, 0.96875, 0.9375, 0.875, 0.875, 1.0, 0.84375, 0.9375, 0.96875, 0.9375, 0.8125, 0.875, 0.9375, 0.9375, 0.84375, 0.84375, 0.90625, 0.84375, 0.96875, 0.96875, 1.0, 0.84375, 0.9375, 0.96875, 0.90625, 0.875, 0.9375, 0.90625, 0.96875, 0.84375, 0.96875, 0.96875, 0.96875, 0.9375, 0.875, 0.9375, 0.8125, 0.90625, 0.9375, 0.9375, 0.90625, 0.875, 0.9375, 0.96875, 0.9375, 0.90625, 0.9375, 0.96875, 0.875, 0.875, 0.90625, 0.84375, 1.0, 0.96875, 0.9375, 0.90625, 0.9375, 0.90625, 0.96875, 0.90625, 0.96875, 0.90625, 0.8125, 0.875, 0.90625, 0.90625, 0.875, 0.875, 0.9375, 0.875, 0.96875, 0.90625, 0.90625, 0.875, 0.875, 0.9375, 1.0, 0.96875, 0.84375, 0.96875, 0.78125, 0.9375, 0.90625, 0.84375, 0.78125, 0.875, 0.875, 0.9375, 0.9375, 0.875, 0.90625, 0.875, 0.875, 0.90625, 0.96875, 0.96875, 0.78125, 0.96875, 0.96875, 0.84375, 0.875, 0.8125, 0.875, 0.875, 0.875, 0.875, 0.9375, 0.78125, 0.9375, 0.84375, 0.96875, 1.0, 0.90625, 0.90625, 1.0, 0.90625, 0.90625, 0.9375, 0.96875, 0.9375, 0.96875, 0.90625, 0.90625, 0.8125, 0.90625, 0.90625, 0.96875, 0.9375, 0.84375, 0.9375, 0.96875, 0.9375, 0.9375, 0.9375, 0.84375, 0.90625, 0.9375, 0.875, 1.0, 0.9375, 1.0, 0.96875, 0.875, 0.9375, 0.9375, 0.9375, 0.875, 0.90625, 0.8125, 0.875, 0.9375, 0.84375, 0.90625, 0.96875, 0.875, 0.90625, 0.90625, 0.90625, 0.875, 1.0, 0.9375, 0.9375, 0.9375, 0.84375, 0.90625, 0.9375, 0.9375, 0.875, 0.875, 0.9375, 0.9375, 0.9375, 0.875, 0.90625, 0.9375, 0.9375, 0.9375, 0.96875, 0.96875, 0.9375, 0.9375, 0.875, 0.875, 0.96875, 0.9375, 0.90625, 0.875, 0.75]]
solo_correctness = [0.75, 0.875, 0.9375, 0.9375, 0.9375, 0.9375, 0.9375, 0.9375, 0.96875, 0.9375, 0.90625, 0.9375, 0.9375, 0.9375, 1.0, 1.0, 0.9375, 0.90625, 0.9375, 0.90625, 0.96875, 0.96875, 1.0, 0.9375, 0.9375, 0.875, 0.9375, 0.90625, 0.875, 0.96875, 0.9375, 0.90625, 0.875, 0.96875, 0.96875, 0.9375, 0.96875, 0.96875, 0.96875, 0.9375, 0.9375, 0.90625, 0.90625, 0.90625, 0.90625, 1.0, 0.78125, 0.90625, 1.0, 0.9375, 0.9375, 1.0, 0.90625, 0.90625, 0.9375, 0.96875, 0.84375, 0.96875, 0.96875, 0.96875, 0.9375, 0.90625, 0.9375, 0.96875, 1.0, 1.0, 0.9375, 0.96875, 0.84375, 1.0, 1.0, 0.96875, 0.84375, 1.0, 0.90625, 0.9375, 0.96875, 1.0, 0.90625, 0.96875, 1.0, 0.96875, 0.96875, 1.0, 0.96875, 0.96875, 0.90625, 0.96875, 0.9375, 1.0, 0.96875, 1.0, 0.9375, 0.90625, 0.96875, 0.96875, 0.9375, 1.0, 0.9375, 1.0, 0.90625, 0.9375, 0.96875, 0.9375, 0.96875, 0.84375, 0.96875, 0.90625, 0.875, 0.90625, 0.9375, 0.96875, 1.0, 0.9375, 0.9375, 0.96875, 0.9375, 0.84375, 0.96875, 0.875, 0.90625, 0.9375, 0.96875, 0.90625, 0.96875, 0.9375, 1.0, 0.90625, 0.90625, 0.96875, 0.9375, 1.0, 0.90625, 0.90625, 0.9375, 0.90625, 0.96875, 0.8125, 0.9375, 0.84375, 0.90625, 0.84375, 0.90625, 1.0, 0.96875, 1.0, 0.9375, 0.96875, 0.875, 1.0, 0.96875, 1.0, 0.875, 0.875, 0.9375, 0.96875, 1.0, 0.84375, 0.9375, 0.875, 0.96875, 1.0, 0.90625, 0.9375, 0.875, 0.96875, 0.96875, 0.96875, 0.96875, 0.96875, 0.90625, 0.90625, 0.90625, 0.96875, 0.9375, 0.8125, 0.9375, 0.9375, 0.96875, 0.90625, 0.96875, 0.90625, 1.0, 0.96875, 1.0, 0.9375, 1.0, 0.9375, 0.9375, 0.9375, 0.875, 0.90625, 0.875, 0.96875, 1.0, 0.90625, 0.84375, 0.9375, 0.9375, 1.0, 1.0, 0.875, 1.0, 1.0, 0.9375, 0.90625, 0.96875, 0.90625, 1.0, 1.0, 0.90625, 0.96875, 0.96875, 1.0, 0.96875, 0.96875, 0.875, 0.90625, 0.96875, 0.90625, 1.0, 0.96875, 0.96875, 1.0, 0.875, 0.9375, 1.0, 0.875, 0.90625, 0.96875, 0.96875, 0.96875, 0.875, 0.96875, 0.9375, 0.875, 0.96875, 0.90625, 0.90625, 0.90625, 0.9375, 1.0, 0.84375, 1.0, 0.9375, 1.0, 0.96875, 0.9375, 0.875, 0.875, 0.9375, 0.9375, 0.96875, 0.90625, 0.96875, 0.9375, 0.96875, 0.96875, 0.9375, 0.96875, 0.96875, 1.0, 0.96875, 0.9375, 0.90625, 0.96875, 0.84375, 1.0, 1.0, 0.96875, 0.90625, 0.96875, 0.90625, 1.0, 0.9375, 1.0, 0.9375, 0.90625, 0.96875, 0.96875, 1.0, 0.90625, 1.0, 0.90625, 1.0, 0.96875, 0.90625, 0.96875, 0.96875, 0.96875, 0.9375, 0.9375, 0.96875, 0.9375, 0.90625, 0.9375, 0.96875, 1.0, 0.96875, 0.875, 0.90625, 0.9375, 0.9375, 0.96875, 0.875, 0.9375, 0.96875, 0.84375, 0.90625, 0.96875, 0.875, 1.0, 1.0]
our_correctness = np.array(our_correctness)
solo_correctness = np.array(solo_correctness)
our_selection = [2, 1, 1, 2, 0, 1, 0, 0, 0, 1, 0, 0, 2, 0, 3, 0, 0, 2, 0, 0, 2, 0, 0, 0, 1, 1, 1, 1, 1, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 1, 1, 2, 1, 0, 2, -1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 2, 0, 0, 1, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 2, 0, 0, 3, 3, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 2, 0, 0, 2, 1, 1, 0, 0, 1, 3, 0, 1, 1, 1, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 3, 1, 1, 0, 0, 1, 1, 2, 0, 3, 1, 1, 0, 2, 1, 1, 1, 1, 1, 1, 1, 2, 0, 1, 1, 0, 0, 1, 1, 0, 1, 3, 1, 2, 1, 1, 1, 1, 0, 2, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 3, 1, 0, 0, 0, 1, 3, 2, 0, 0, 2, 2, 2, 2, 3, 0, 1, 0, 3, 1, 0, 3, 3, 0, 1, 0, 1, 1, 1, 2, 1, 1, 2, 2, 0, 1, 1, 0, 0, 1, 1, 0, 2, 1, 0, 1, 2, 1, 1, 1, 0, 2, 1, 1, 0, 1, 1, 1, 3, 1, 1, 1, 2, 1, 2, 0, 0, 1, 1, -1, 1, 0, 1, 0, 1, 3, 2, 2, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
solo_selection = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
dbl_selection = [0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, -1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 1, -1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
our_selection = np.array(our_selection)
solo_selection = np.array(solo_selection)
dbl_selection = np.array(dbl_selection)
num_subnet,num_query = our_correctness.shape

solo_correctness_w_loss = np.array(solo_correctness)
solo_correctness_w_loss[solo_selection==-1] = -1

dbl_correctness_w_loss = np.array(solo_correctness)


# available service networks
# chosen/adopted service network

exit(0)

# computation distribution bar

analyze_all_recorded_traces()

plot_latency_breakdown()

# # latency vs batch size
# x = [[2**(i+1) for i in range(7)] for _ in range(3)]
# y = []
# y += [[0.06418062899560083, 0.09487899659120094, 0.1562757317824031, 0.27906920216480446, 0.524656142929607, 1.0158300244592218, 1.9981777875184359]]
# y += [[0.06531043202319999, 0.12616752997310016, 0.19652943671249992, 0.2586958761966974, 0.3242253297511007, 0.400030623838503, 0.48320091845820135]]
# y += [[0.0005560131160076708, 0.0008610515860840678, 0.0013787966246335682, 0.00254509048006201, 0.005519364917724901, 0.014306930020239882, 0.036008807941064744]]
# yerr = []
# yerr += [[0.04366536008475055, 0.057813441160034985, 0.08983038309518751, 0.15794390699592412, 0.2973047728370379, 0.5779610617317479, 1.1403426471373188]]
# yerr += [[0.02743477279272752, 0.023558256553651857, 0.05086187910056275, 0.053107698075911036, 0.05826275421988924, 0.10012209236168, 0.17340102056875514]]
# yerr += [[5.584275363686748e-05, 7.21147853243953e-05, 9.44465883291553e-05, 0.00013102205731442052, 0.0004088092732089768, 0.0011088897266866326, 0.0014427948576510956]]
# line_plot(x, y,['FCC','Wi-Fi','DC-DC'],colors,
# 		'/home/bo/Dropbox/Research/SIGCOMM23/images/latency_vs_bs.eps',
# 		'Query Batch Size','Latency (s)',yerr=yerr)	

# FCC-2nodes
x = [[0.2*i for i in range(1,10)] for _ in range(3)]
y = [[0.10053515434265137, 0.11851239204406738, 0.4115534722805023, 0.6619688272476196, 0.7965036630630493, 0.8551257848739624, 0.9001497030258179, 0.9154112935066223, 0.9208625555038452], [0.10027756541967392, 0.12076280266046524, 0.3006569445133209, 0.47837257385253906, 0.6171784996986389, 0.693761944770813, 0.7762260437011719, 0.8347564935684204, 0.8560543060302734], [0.1005651131272316, 0.1319209337234497, 0.44014573097229004, 0.6778314709663391, 0.8077834844589233, 0.8582148551940918, 0.900483250617981, 0.9165775179862976, 0.9203234910964966]]
yerr = [[0.0010702908039093018, 0.0130164148285985, 0.06449627876281738, 0.04332319647073746, 0.028338516131043434, 0.024029118940234184, 0.019376114010810852, 0.0199959147721529, 0.019873330369591713], [0.0008326693787239492, 0.014998381957411766, 0.060017187148332596, 0.05467825010418892, 0.049944449216127396, 0.043020911514759064, 0.04179437831044197, 0.02501348964869976, 0.022911738604307175], [0.0011304139625281096, 0.021325737237930298, 0.06393025070428848, 0.04011991247534752, 0.022756922990083694, 0.025738680735230446, 0.019793668761849403, 0.02041413076221943, 0.020137231796979904]]
line_plot(x, y,['Ours','No replica','Optimal'],colors,
		'/home/bo/Dropbox/Research/SIGCOMM23/images/FCC_ea.eps',
		'Deadline','Effective Top1 Accuracy (%)',
		yerr=yerr)	
y = [[0.9993610223642172, 0.9779552715654953, 0.6297124600638977, 0.3319488817891374, 0.1722044728434505, 0.10287539936102237, 0.04952076677316295, 0.03130990415335465, 0.02492012779552717], [0.9996805111821085, 0.9753993610223644, 0.7616613418530351, 0.5507987220447285, 0.3859424920127795, 0.2942492012779553, 0.19616613418530351, 0.12651757188498403, 0.10127795527156551], [0.9993610223642172, 0.9619808306709265, 0.5958466453674122, 0.31405750798722043, 0.15910543130990412, 0.09872204472843452, 0.04856230031948884, 0.029392971246006407, 0.02492012779552717]]
yerr = [[0.0012779552715655117, 0.01561578199341846, 0.07647003399018283, 0.05086699452986285, 0.03394559293352903, 0.029517723865689686, 0.023704692398146376, 0.02440693834477223, 0.024154706928352445], [0.0009584664536741339, 0.017733787969812034, 0.07079687659790179, 0.06441008670828668, 0.05921843958644172, 0.051087251007935174, 0.049930286506290854, 0.02960060018377117, 0.0272990061693725], [0.0012779552715655117, 0.025537131128936182, 0.07658740735197307, 0.04847499298221035, 0.027364361795992154, 0.030692550949833794, 0.023857066712580786, 0.02436508110535158, 0.024154706928352445]]
line_plot(x, y,['Ours','No replica','Optimal'],colors,
		'/home/bo/Dropbox/Research/SIGCOMM23/images/FCC_fr.eps',
		'Deadline','Failure Rate',
		yerr=yerr)
# FCC-3nodes
y = [[0.10053515434265137, 0.14325681328773499, 0.534550666809082, 0.7910283803939819, 0.8858405947685242, 0.9186540842056274, 0.9332526922225952, 0.9369888305664062, 0.9383167028427124], [0.10027756541967392, 0.12064298242330551, 0.3004692494869232, 0.4780130982398987, 0.6166073679924011, 0.6934224963188171, 0.7757267951965332, 0.8345667719841003, 0.8558347821235657], [0.10055512189865112, 0.16379192471504211, 0.5675219297409058, 0.8028733134269714, 0.8902636766433716, 0.9199161529541016, 0.9338498115539551, 0.9376258850097656, 0.93870609998703]]
yerr = [[0.0010740082943812013, 0.025693265721201897, 0.07340136170387268, 0.04458346962928772, 0.017115285620093346, 0.011391675099730492, 0.008146831765770912, 0.005364423152059317, 0.005108519922941923], [0.0008326693787239492, 0.014884065836668015, 0.05902642756700516, 0.05383582413196564, 0.04997469112277031, 0.04321608319878578, 0.041800808161497116, 0.02484920062124729, 0.022737231105566025], [0.0011102259159088135, 0.040364544838666916, 0.0739668682217598, 0.038691144436597824, 0.016285866498947144, 0.010587590746581554, 0.00688437232747674, 0.004258322529494762, 0.004151879344135523]]
line_plot(x, y,['Ours','No replica','Optimal'],colors,
		'/home/bo/Dropbox/Research/SIGCOMM23/images/FCC_ea3.eps',
		'Deadline','Effective Top1 Accuracy (%)',yerr=yerr)	
y = [[0.9993610223642172, 0.9482428115015974, 0.4817891373801917, 0.17795527156549518, 0.06517571884984026, 0.026198083067092648, 0.008945686900958493, 0.004472843450479236, 0.0028753993610223572], [0.9996805111821085, 0.9753993610223644, 0.7619808306709265, 0.5507987220447285, 0.3856230031948881, 0.2942492012779553, 0.19616613418530351, 0.12651757188498403, 0.10127795527156551], [0.9993610223642172, 0.923961661341853, 0.4440894568690096, 0.1642172523961661, 0.06038338658146965, 0.025239616613418538, 0.008626198083067116, 0.004153354632587858, 0.0028753993610223572]]
yerr = [[0.0012779552715655117, 0.030836877985977378, 0.08802830124897357, 0.05263426769915932, 0.02016579404224854, 0.013311608086900741, 0.008428693903049804, 0.0049905748727837995, 0.005041448510562133], [0.0009584664536741339, 0.017733787969812034, 0.07049417781012195, 0.06441008670828668, 0.05927443242125811, 0.051087251007935174, 0.049930286506290854, 0.02960060018377117, 0.0272990061693725], [0.0012779552715655117, 0.04776972189537551, 0.08842397765557856, 0.046456794196277386, 0.019509756729421127, 0.012894847329463622, 0.008337372748051061, 0.005161499815144887, 0.005041448510562133]]
line_plot(x, y,['Ours','No replica','Optimal'],colors,
		'/home/bo/Dropbox/Research/SIGCOMM23/images/FCC_fr3.eps',
		'Deadline','Failure Rate',yerr=yerr)
# FCC-4nodes
y = [[0.10080273449420929, 0.16486220061779022, 0.6271725296974182, 0.8477336168289185, 0.9090674519538879, 0.9266773462295532, 0.9332168698310852, 0.9340394735336304, 0.9343070983886719], [0.10027756541967392, 0.1206030622124672, 0.3010343015193939, 0.4775439202785492, 0.6165375709533691, 0.6934324502944946, 0.7760842442512512, 0.8344868421554565, 0.8558047413825989], [0.10080273449420929, 0.18924321234226227, 0.6558526158332825, 0.8617990612983704, 0.9179931879043579, 0.9332748651504517, 0.9397464990615845, 0.9405691027641296, 0.9408367276191711]]
yerr = [[0.0012269837316125631, 0.02890845015645027, 0.06715486198663712, 0.0329834409058094, 0.012616042047739029, 0.004936812911182642, 0.0024480673018842936, 0.0021105764899402857, 0.0020216184202581644], [0.0008326693787239492, 0.015036160126328468, 0.05918773263692856, 0.05410036817193031, 0.049823079258203506, 0.04300602152943611, 0.042494919151067734, 0.024830389767885208, 0.02287847362458706], [0.0012269837316125631, 0.045982521027326584, 0.06808334589004517, 0.027092885226011276, 0.013079861178994179, 0.004524329677224159, 0.0021768200676888227, 0.0015754580963402987, 0.0007727444171905518]]
line_plot(x, y,['Ours','No replica','Optimal'],colors,
		'/home/bo/Dropbox/Research/SIGCOMM23/images/FCC_ea4.eps',
		'Deadline','Effective Top1 Accuracy (%)',yerr=yerr)	
y = [[0.9990415335463257, 0.9226837060702875, 0.368370607028754, 0.10383386581469649, 0.030670926517571882, 0.009584664536741228, 0.0015974440894568676, 0.0006389776357827448, 0.00031948881789137793], [0.9996805111821085, 0.9753993610223644, 0.7613418530351437, 0.5507987220447285, 0.3856230031948881, 0.2942492012779553, 0.19584664536741214, 0.12651757188498403, 0.10127795527156551], [0.9990415335463257, 0.893929712460064, 0.33897763578274753, 0.09392971246006387, 0.027476038338658172, 0.00926517571884986, 0.0015974440894568676, 0.0006389776357827448, 0.00031948881789137793]]
yerr = [[0.001464081691679201, 0.03440406549769151, 0.08072452589412768, 0.0388215068196273, 0.014930762230732154, 0.005533708650379788, 0.002575801197539465, 0.0019169329073482342, 0.0009584664536741336], [0.0009584664536741339, 0.017733787969812034, 0.07008466218825478, 0.06441008670828668, 0.05927443242125811, 0.051087251007935174, 0.050070126082845896, 0.02960060018377117, 0.0272990061693725], [0.001464081691679201, 0.0546279167705853, 0.08057771478844458, 0.03227311514165977, 0.015201760068204895, 0.005240006219443037, 0.002575801197539465, 0.0019169329073482342, 0.0009584664536741336]]
line_plot(x, y,['Ours','No replica','Optimal'],colors,
		'/home/bo/Dropbox/Research/SIGCOMM23/images/FCC_fr4.eps',
		'Deadline','Failure Rate',yerr=yerr)

# mean accuracy/latency vs.nodes of three approaches
# # 2-node
# [0.941703200340271, 0.9411941766738892, 0.9411941766738892]
# [0.0010931950528174639, 5.960464477539063e-08, 5.960464477539063e-08]
# [0.7683045963183902, 1.022090410951564, 0.7511619348866739]
# [0.036507783683489094, 0.06380534150585028, 0.03642609434278379]
# # 3-node
# [0.9406549334526062, 0.9410942196846008, 0.9410942196846008]
# [0.0019054547883570194, 0.0, 0.0]
# [0.6421675192208194, 1.0216991279772232, 0.6265274772529117]
# [0.03688555900682125, 0.06380534150585028, 0.03674916238221722]
# # 4-node
# [0.9345746040344238, 0.9410942196846008, 0.9410942196846008]
# [0.002237866632640362, 0.0, 0.0]
# [0.5867612339610099, 1.0216739911941233, 0.5720289794047533]
# [0.03288692239761618, 0.0638053415058503, 0.03270002455135555]

x = [[2,3,4] for _ in range(3)]
y = [
[0.941703200340271, 0.9411941766738892, 0.9411941766738892],
[0.9406549334526062, 0.9410942196846008, 0.9410942196846008],
[0.9345746040344238, 0.9410942196846008, 0.9410942196846008]
]
yerr = [
[0.0010931950528174639, 5.960464477539063e-08, 5.960464477539063e-08],
[0.0019054547883570194, 0.0, 0.0],
[0.002237866632640362, 0.0, 0.0],
]
y = np.array(y).transpose((1,0))
yerr = np.array(yerr).transpose((1,0))
line_plot(x, y,['Ours','NR','TR'],colors,
		'/home/bo/Dropbox/Research/SIGCOMM23/images/accuracy_vs_nodes.eps',
		'Number of replicas','Top-1 Accuracy (Infinite deadline)',yerr=yerr)
y = [
[0.7683045963183902, 1.022090410951564, 0.7511619348866739],
[0.6421675192208194, 1.0216991279772232, 0.6265274772529117],
[0.5867612339610099, 1.0216739911941233, 0.5720289794047533]
]
yerr = [
[0.036507783683489094, 0.06380534150585028, 0.03642609434278379],
[0.03688555900682125, 0.06380534150585028, 0.03674916238221722],
[0.03288692239761618, 0.0638053415058503, 0.03270002455135555]
]
y = np.array(y).transpose((1,0))
yerr = np.array(yerr).transpose((1,0))
line_plot(x, y,['Ours','NR','TR'],colors,
		'/home/bo/Dropbox/Research/SIGCOMM23/images/latency_vs_nodes.eps',
		'Number of replicas','Query Latency',yerr=yerr)

# Wi-Fi
x = [[0.2+0.1*i for i in range(1,10)]for _ in range(3)]
y = [[0.10000000894069672, 0.9101996421813965, 0.931287944316864, 0.9337360262870789, 0.9391573667526245, 0.9418530464172363, 0.9418530464172363, 0.9418530464172363, 0.9418530464172363], [0.10000000894069672, 0.7847703695297241, 0.8569148778915405, 0.8692252039909363, 0.9235442876815796, 0.9353175163269043, 0.9382208585739136, 0.9390336275100708, 0.9395686984062195], [0.10000000894069672, 0.9108685255050659, 0.9312041401863098, 0.9334346055984497, 0.9411941766738892, 0.9411941766738892, 0.9411941766738892, 0.9411941766738892, 0.9411941766738892]]
yerr = [[0.0, 0.012535853311419487, 0.0070809535682201385, 0.004068393260240555, 0.002986897248774767, 0.001973809441551566, 0.001973809441551566, 0.001973809441551566, 0.001973809441551566], [0.0, 0.049521930515766144, 0.03962377831339836, 0.021610815078020096, 0.011123483069241047, 0.007515979930758476, 0.004067623987793922, 0.002647061599418521, 0.002176515059545636], [0.0, 0.013526730239391327, 0.007271786220371723, 0.004095328040421009, 5.960464477539063e-08, 5.960464477539063e-08, 5.960464477539063e-08, 5.960464477539063e-08, 5.960464477539063e-08]]
line_plot(x, y,['Ours','No replica','Optimal'],colors,
		'/home/bo/Dropbox/Research/SIGCOMM23/images/WF_ea.eps',
		'Deadline','Effective Top1 Accuracy (%)',
		yerr=yerr)	
y = [[1.0, 0.037699680511182124, 0.012460063897763584, 0.009584664536741238, 0.003194888178913746, 0.0, 0.0, 0.0, 0.0], [1.0, 0.18626198083067091, 0.1, 0.08562300319488818, 0.02108626198083069, 0.007028753993610226, 0.003514376996805113, 0.0025559105431310013, 0.0019169329073482455], [1.0, 0.036102236421725255, 0.01182108626198084, 0.00926517571884986, 0.0, 0.0, 0.0, 0.0, 0.0]]
yerr = [[0.0, 0.016215434556484994, 0.009198837091941185, 0.0049494994839711535, 0.002474749741985559, 0.0, 0.0, 0.0, 0.0], [0.0, 0.05861640367035917, 0.04647546632123396, 0.02547109447667061, 0.013342244739821792, 0.009126426106764018, 0.004834743115150649, 0.0031303383294353734, 0.002555910543130985], [0.0, 0.01591362224333836, 0.00845891520439215, 0.004834743115150669, 0.0, 0.0, 0.0, 0.0, 0.0]]
line_plot(x, y,['Ours','No replica','Optimal'],colors,
		'/home/bo/Dropbox/Research/SIGCOMM23/images/WF_fr.eps',
		'Deadline','Failure Rate',
		yerr=yerr)

# with loss
x = [[0.05*i for i in range(1,6)] for _ in range(3)]
y = [[0.9367472044728435, 0.9282607827476038, 0.9142771565495208, 0.9023422523961664, 0.872723642172524], [0.8954772364217252, 0.8559444888178914, 0.8107388178913737, 0.7767551916932908, 0.7335483226837061], [0.938993610223642, 0.932364217252396, 0.919798322683706, 0.9097204472843451, 0.8820287539936101]]
yerr = [[0.0030383087636647235, 0.005929112917530137, 0.006354748740820697, 0.00935310868081683, 0.01577453036998163], [0.012796864054925493, 0.014682110413133236, 0.017066750178676125, 0.016672039537586066, 0.018830112433629673], [0.0032342670998862936, 0.005150145561127292, 0.0060353628569493134, 0.009336885617808682, 0.016954378228470235]]
line_plot(x, y,['Ours','No replica','Optimal'],colors,
		'/home/bo/Dropbox/Research/SIGCOMM23/images/FCC_loss_ea.eps',
		'Loss Rate','Effective Top1 Accuracy (%)',
		yerr=yerr)	
y = [[0.0025559105431310126, 0.01054313099041535, 0.025559105431309903, 0.037699680511182124, 0.07028753993610223], [0.054313099041533544, 0.10127795527156551, 0.1559105431309904, 0.19616613418530351, 0.2463258785942492], [0.0025559105431310126, 0.01054313099041535, 0.025559105431309903, 0.037699680511182124, 0.07028753993610223]]
yerr = [[0.0037258478561312002, 0.006236172938000998, 0.0074242492259567255, 0.010956184153023804, 0.020155668109377002], [0.01471036988271096, 0.01761829479739584, 0.020397303130367247, 0.02051705349265474, 0.022475760175030758], [0.0037258478561312002, 0.006236172938000998, 0.0074242492259567255, 0.010956184153023804, 0.020155668109377002]]
line_plot(x, y,['Ours','No replica','Optimal'],colors,
		'/home/bo/Dropbox/Research/SIGCOMM23/images/FCC_loss_fr.eps',
		'Loss Rate','Failure Rate',
		yerr=yerr)	

# stds
x = [[0.2*i for i in range(1,10)] for j in range(3)]
Ys = [[[0.10000000894069672, 0.10000000894069672, 0.10000000894069672, 0.1234465017914772, 0.6602116823196411, 0.9398621320724487, 0.9406648874282837, 0.9406648874282837, 0.9406648874282837], [0.10000000894069672, 0.10136783123016357, 0.13034744560718536, 0.314656525850296, 0.6960063576698303, 0.9076517820358276, 0.9391552805900574, 0.9402056932449341, 0.9402056932449341], [0.10543131828308105, 0.13269570469856262, 0.23529751598834991, 0.44761180877685547, 0.7098841667175293, 0.8775140047073364, 0.9340116381645203, 0.9398581385612488, 0.9401257634162903], [0.13414138555526733, 0.19298923015594482, 0.321962833404541, 0.5123581886291504, 0.7076237797737122, 0.8480172157287598, 0.9133267402648926, 0.936190128326416, 0.9404413104057312], [0.18182706832885742, 0.2717052698135376, 0.4150518774986267, 0.5729652047157288, 0.7236022353172302, 0.8445388078689575, 0.9048143625259399, 0.9325639605522156, 0.9394708871841431]], [[0.10000000894069672, 0.10000000894069672, 0.10000000894069672, 0.11794928461313248, 0.5062659978866577, 0.9213237762451172, 0.9409365653991699, 0.9411941766738892, 0.9411941766738892], [0.10000000894069672, 0.10161542892456055, 0.11791734397411346, 0.22806313633918762, 0.5050339102745056, 0.8044587969779968, 0.9237020611763, 0.9404013752937317, 0.9409464597702026], [0.10371607542037964, 0.11772964894771576, 0.1804552674293518, 0.31458863615989685, 0.5174460411071777, 0.7305811047554016, 0.864688515663147, 0.9260702133178711, 0.9388159513473511], [0.12029755115509033, 0.15532946586608887, 0.23204472661018372, 0.3600459098815918, 0.5252315998077393, 0.6847623586654663, 0.8044408559799194, 0.8836142420768738, 0.9213738441467285], [0.14350640773773193, 0.19636979699134827, 0.2833905816078186, 0.39600038528442383, 0.5354133248329163, 0.6605111360549927, 0.7742432355880737, 0.8528314828872681, 0.8993629217147827]], [[0.10000000894069672, 0.10000000894069672, 0.10000000894069672, 0.13510385155677795, 0.7237959504127502, 0.9409166574478149, 0.9411941766738892, 0.9411941766738892, 0.9411941766738892], [0.10000000894069672, 0.10190296173095703, 0.1343390792608261, 0.3426377773284912, 0.7274959683418274, 0.9197384119033813, 0.9409166574478149, 0.9411941766738892, 0.9411941766738892], [0.1063917875289917, 0.136341854929924, 0.25194090604782104, 0.46980634331703186, 0.7287579774856567, 0.8850140571594238, 0.9366054534912109, 0.9409365653991699, 0.9411941766738892], [0.13698682188987732, 0.20323681831359863, 0.33769965171813965, 0.5349161028862, 0.7241413593292236, 0.8560223579406738, 0.9174880981445312, 0.9366453886032104, 0.9403914213180542], [0.1876876801252365, 0.2823043167591095, 0.42797723412513733, 0.5843570828437805, 0.7319787740707397, 0.8517352938652039, 0.908115029335022, 0.9336321949958801, 0.9396286010742188]]]
YERRs = [[[0.0, 0.0, 0.0, 0.005230887793004513, 0.020680660381913185, 0.0022129870485514402, 0.0015467474004253745, 0.0015467474004253745, 0.0015467474004253745], [0.0, 0.0018323330441489816, 0.007708917837589979, 0.030038023367524147, 0.01670229434967041, 0.007933992892503738, 0.0029925198759883642, 0.0019475067965686321, 0.0019475067965686321], [0.0036845155991613865, 0.0073768761940300465, 0.02282513678073883, 0.025354357436299324, 0.0238095223903656, 0.00999614130705595, 0.003381600370630622, 0.001722637563943863, 0.0015363995917141438], [0.01007137168198824, 0.018763257190585136, 0.02304946817457676, 0.029327023774385452, 0.02164234034717083, 0.01433481089770794, 0.007597366347908974, 0.004040644038468599, 0.0019613450858742], [0.016798706725239754, 0.023756859824061394, 0.022297341376543045, 0.020159607753157616, 0.016606085002422333, 0.013803456909954548, 0.00638938182964921, 0.002470136620104313, 0.003103881608694792]], [[0.0, 0.0, 0.0, 0.006518627516925335, 0.029275977984070778, 0.008341534063220024, 0.0007727623451501131, 5.960464477539063e-08, 5.960464477539063e-08], [0.0, 0.0017988461768254638, 0.004974487703293562, 0.01787710003554821, 0.02199803665280342, 0.01699485443532467, 0.006648260168731213, 0.0012128340313211083, 0.0007428109529428184], [0.003267860971391201, 0.0057851155288517475, 0.0148616349324584, 0.01736372709274292, 0.019901065155863762, 0.011981724761426449, 0.011728312820196152, 0.007564783561974764, 0.001872471533715725], [0.012416345998644829, 0.017421504482626915, 0.019028106704354286, 0.0187537744641304, 0.016293829306960106, 0.016154706478118896, 0.015668954700231552, 0.01317531056702137, 0.0061455038376152515], [0.01554141379892826, 0.022564493119716644, 0.02577846124768257, 0.02572254277765751, 0.03134910389780998, 0.0197205301374197, 0.016672739759087563, 0.014901731163263321, 0.009314330294728279]], [[0.0, 0.0, 0.0, 0.006140294950455427, 0.021545464172959328, 0.0008326649549417198, 5.960464477539063e-08, 5.960464477539063e-08, 5.960464477539063e-08], [0.0, 0.0024871465284377337, 0.007305915001779795, 0.03530470281839371, 0.01597539521753788, 0.007834608666598797, 0.0008326649549417198, 5.960464477539063e-08, 5.960464477539063e-08], [0.0038414658047258854, 0.00777417840436101, 0.026173299178481102, 0.028070250526070595, 0.022729935124516487, 0.010957642458379269, 0.0024500242434442043, 0.0007727623451501131, 5.960464477539063e-08], [0.010867188684642315, 0.023839663714170456, 0.024469774216413498, 0.028167085722088814, 0.020028049126267433, 0.012508517131209373, 0.005543376784771681, 0.00280367536470294, 0.0012269780272617936], [0.017185255885124207, 0.024786867201328278, 0.022736994549632072, 0.01808529905974865, 0.015916118398308754, 0.010641109198331833, 0.00608012406155467, 0.0032863100059330463, 0.0017222617752850056]]]
Ys,YERRs = np.array(Ys),np.array(YERRs)
for i,std in enumerate([0.1,0.2,0.3,0.4,0.5]):
	y = Ys[:,i,:]
	yerr = YERRs[:,i,:]
	line_plot(x, y,['Ours','No replica','Optimal'],colors,
		f'/home/bo/Dropbox/Research/SIGCOMM23/images/syn{i}_ea.eps',
		'Deadline','Effective Top1 Accuracy (%)',yerr=yerr)	
Ys = [[[1.0, 1.0, 1.0, 0.971884984025559, 0.33354632587859423, 0.0009584664536741227, 0.0, 0.0, 0.0], [1.0, 0.9984025559105432, 0.9642172523961662, 0.7444089456869009, 0.29073482428115016, 0.03897763578274761, 0.0012779552715655007, 0.0, 0.0], [0.9936102236421724, 0.9613418530351439, 0.839297124600639, 0.5859424920127796, 0.2747603833865815, 0.07476038338658145, 0.0073482428115016155, 0.00031948881789137793, 0.0], [0.9594249201277956, 0.8894568690095846, 0.7361022364217252, 0.5092651757188498, 0.27731629392971247, 0.1108626198083067, 0.03322683706070288, 0.006070287539936115, 0.0009584664536741339], [0.9022364217252397, 0.7955271565495208, 0.6255591054313099, 0.4380191693290735, 0.2587859424920128, 0.11501597444089455, 0.043450479233226855, 0.01054313099041535, 0.0022364217252396233]], [[1.0, 1.0, 1.0, 0.9789137380191694, 0.5169329073482428, 0.02364217252396166, 0.00031948881789137793, 0.0, 0.0], [1.0, 0.9980830670926517, 0.9785942492012779, 0.847923322683706, 0.517891373801917, 0.1623003194888179, 0.02076677316293931, 0.0009584664536741339, 0.00031948881789137793], [0.9955271565495206, 0.9789137380191695, 0.9047923322683706, 0.7447284345047922, 0.5038338658146966, 0.2507987220447284, 0.09137380191693292, 0.01789137380191692, 0.0028753993610223794], [0.976038338658147, 0.9341853035143769, 0.8428115015974441, 0.6904153354632587, 0.4939297124600638, 0.3047923322683706, 0.16261980830670925, 0.068370607028754, 0.02364217252396166], [0.9482428115015976, 0.8856230031948883, 0.7817891373801917, 0.6476038338658147, 0.48242811501597443, 0.3335463258785943, 0.19840255591054312, 0.10479233226837063, 0.0498402555910543]], [[1.0, 1.0, 1.0, 0.9584664536741213, 0.25782747603833867, 0.00031948881789137793, 0.0, 0.0, 0.0], [1.0, 0.9977635782747603, 0.9591054313099041, 0.7118210862619808, 0.2539936102236422, 0.025559105431309903, 0.00031948881789137793, 0.0, 0.0], [0.9923322683706072, 0.9568690095846645, 0.8201277955271566, 0.5603833865814696, 0.25303514376996805, 0.06709265175718851, 0.005431309904153381, 0.00031948881789137793, 0.0], [0.9562300319488817, 0.8773162939297124, 0.7172523961661341, 0.4827476038338657, 0.257188498402556, 0.10095846645367412, 0.028115015974440903, 0.005431309904153359, 0.0009584664536741339], [0.895846645367412, 0.78370607028754, 0.6105431309904154, 0.42364217252396175, 0.24920127795527156, 0.10670926517571884, 0.03961661341853036, 0.008945686900958493, 0.0019169329073482565]]]
YERRs = [[[0.0, 0.0, 0.0, 0.006195118028647078, 0.0233117397405172, 0.0020457265934290224, 0.0, 0.0, 0.0], [0.0, 0.0021431961445684913, 0.009013888804898312, 0.03676204437991701, 0.02010496194575368, 0.010576961889614598, 0.002119249067319745, 0.0, 0.0], [0.004286392289136967, 0.008626198083067088, 0.027186602427482182, 0.031179227856245002, 0.028107753927057836, 0.012307578456395024, 0.0032108228821472475, 0.0009584664536741338, 0.0], [0.012211830577390661, 0.022555095967696868, 0.02756505381485365, 0.03512052673140265, 0.025670682973291583, 0.01672669662965934, 0.008355716824678611, 0.0038998580241960804, 0.0014640816916792014], [0.020417310298620393, 0.02861164623289215, 0.02660787580020066, 0.02392755826626554, 0.01906253532290901, 0.016477695793262147, 0.007587439033251054, 0.0032108228821472722, 0.0024952874363918976]], [[0.0, 0.0, 0.0, 0.007587439033251081, 0.034255399753815245, 0.009816160700151568, 0.0009584664536741338, 0.0, 0.0], [0.0, 0.0021192490673197484, 0.0058997397164918435, 0.021583828439686287, 0.025854917579789378, 0.020347199141329923, 0.007727403592618434, 0.0014640816916792014, 0.0009584664536741338], [0.0038338658146964853, 0.006578677406381503, 0.017948334703115826, 0.021020810414819152, 0.024207471871584157, 0.014658236098344367, 0.014013873609879435, 0.008945686900958457, 0.0022364217252396107], [0.01451829746645594, 0.02056674369256369, 0.023074083176061067, 0.023670219095196735, 0.01928611919844929, 0.019391681668362328, 0.01809841410641348, 0.015533860423186208, 0.007451695712262372], [0.018618277679659363, 0.026722713950576987, 0.03061263096794815, 0.029972410563247658, 0.036595069810291016, 0.023659435886995053, 0.019923912878810048, 0.01800511540396852, 0.011268493347315268]], [[0.0, 0.0, 0.0, 0.007143987148561616, 0.02568062167937198, 0.0009584664536741337, 0.0, 0.0, 0.0], [0.0, 0.0028753993610223733, 0.00854893812157166, 0.04206589288340648, 0.019655704045076074, 0.008922837088670237, 0.0009584664536741337, 0.0, 0.0], [0.004563213053381999, 0.009504456728845688, 0.03143516704518351, 0.033787358636171945, 0.02653104088437915, 0.012699429338243959, 0.00287539936102235, 0.0009584664536741338, 0.0], [0.012703447509310557, 0.028115015974440886, 0.029325175320584377, 0.03358281903692758, 0.023833523196879567, 0.014514781714505485, 0.0065163188672112335, 0.0032108228821472492, 0.0014640816916792014], [0.02071509914050776, 0.029733065101092613, 0.02772198415915026, 0.02125020977420561, 0.01911600677527359, 0.012634964813600739, 0.007028753993610205, 0.0037258478561311963, 0.0021192490673197484]]]
Ys,YERRs = np.array(Ys),np.array(YERRs)
for i,std in enumerate([0.1,0.2,0.3,0.4,0.5]):
	y = Ys[:,i,:]
	yerr = YERRs[:,i,:]
	line_plot(x, y,['Ours','No replica','Optimal'],colors,
		f'/home/bo/Dropbox/Research/SIGCOMM23/images/syn{i}_fr.eps',
		'Deadline','Failure Rate',yerr=yerr)	